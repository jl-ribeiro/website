---
import Layout from '../../../layouts/Layout.astro';
import { Icon } from 'astro-icon/components';
import { allProjects } from '../../../data/projects.js';
import pt from '../../../i18n/pt.js';
import en from '../../../i18n/en.js';

export async function getStaticPaths() {
  const paths = [];
  for (const slug of Object.keys(allProjects)) {
    for (const lang of ['en', 'pt']) {
      paths.push({
        params: { lang, slug },
        props: { project: allProjects[slug] }
      });
    }
  }
  return paths;
}

const { lang } = Astro.params;
const { project: projectDataByLang } = Astro.props;
const t = lang === 'pt' ? pt : en;

if (!projectDataByLang || !projectDataByLang[lang]) {
  return Astro.redirect('/404');
}

const project = {
  ...projectDataByLang[lang],
  architectureDiagram: projectDataByLang.architectureDiagram,
  technologies: projectDataByLang.technologies,
};
---

<Layout title={project.title}>
  <main class="pt-24 pb-20">
    <article class="max-w-4xl mx-auto px-4">
      
      <header class="text-center mb-12">
        <h1 class="text-4xl md:text-5xl font-bold text-white mb-4">{project.title}</h1>
        <p class="text-lg md:text-xl text-slate-300">{project.subtitle}</p>
      </header>
      
      <div class="prose prose-invert prose-lg max-w-none mx-auto">
        <section class="mt-12">
          <h2>{t.projectPage.context}</h2>
          <blockquote class="border-l-4 border-emerald-500 bg-slate-800/50 p-4 rounded-r-lg not-prose">
            <p class="text-slate-300">{project.summary}</p>
          </blockquote>
        </section>

        <section class="mt-12">
          <h2>{t.projectPage.problem}</h2>
          {(project.challenge || []).map((paragraph) => <p>{paragraph}</p>)}
        </section>

        <section class="mt-12">
          <h2>{t.projectPage.solution}</h2>
          <ul class="list-none p-0 mb-8">
            {(project.myContribution || []).map((item) => (
              <li class="flex items-start mb-2">
                <Icon name="mdi:check-decagram" class="text-emerald-400 w-6 h-6 mr-3 flex-shrink-0 mt-1" />
                <span>{item}</span>
              </li>
            ))}
          </ul>
          <figure>
            <img src={project.architectureDiagram} alt={`Diagrama de arquitetura do projeto ${project.title}`} class="rounded-lg shadow-lg" />
            <figcaption class="text-center text-sm text-slate-400 mt-2">Diagrama de alto nível da arquitetura da solução.</figcaption>
          </figure>
        </section>

        <section class="mt-12">
          <h2>{t.projectPage.results}</h2>
          <ul class="list-none p-0">
            {(project.results || []).map((item) => (
              <li class="flex items-start mb-2">
                <Icon name="mdi:trophy-variant" class="text-amber-400 w-6 h-6 mr-3 flex-shrink-0 mt-1" />
                <span>{item}</span>
              </li>
            ))}
          </ul>
        </section>

        <section class="mt-12">
          <h2>{t.projectPage.technologies}</h2>
          <div class="flex flex-wrap gap-3">
            {(project.technologies || []).map(tech => (
              <span class="bg-slate-700 text-emerald-300 font-medium px-4 py-2 rounded-lg">{tech}</span>
            ))}
          </div>
        </section>

        <section class="mt-12">
          <h2>{t.projectPage.deepDive}</h2>
          {(project.techDeepDive || []).map((item) => (
            <div class="mb-8 border-l-2 border-slate-700 pl-4">
              <h3 class="text-emerald-400 not-prose text-xl font-semibold">{item.title}</h3>
              <p>{item.description}</p>
              {item.code && (
                <div class="bg-slate-900 rounded-lg overflow-hidden my-4">
                  <pre class="p-4 text-sm"><code class={`language-${item.codeLanguage}`}>{item.code}</code></pre>
                </div>
              )}
              {item.embedUrl && (
                <div class="aspect-w-16 aspect-h-9 my-4 rounded-lg overflow-hidden">
                  <iframe src={item.embedUrl} frameborder="0" style="border:0; width: 100%; height: 500px;" allowfullscreen></iframe>
                </div>
              )}
            </div>
          ))}
        </section>
      </div>

      <div class="text-center mt-16">
        <a href={`/${lang}/#projetos`} class="text-emerald-400 hover:text-emerald-300 font-semibold">
          &larr; Voltar para todos os projetos
        </a>
      </div>

    </article>
  </main>
</Layout>